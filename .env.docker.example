# ============================================================================
# V_TRACK DOCKER ENVIRONMENT CONFIGURATION TEMPLATE
# ============================================================================
# INSTRUCTIONS:
#   1. Copy this file to .env: cp .env.docker.example .env
#   2. Replace all <REPLACE_WITH_...> placeholders with your actual values
#   3. Generate secure keys using the commands provided below
#   4. DO NOT commit .env to version control
#   5. For Docker deployment: docker-compose up -d
#
# REQUIRED vs OPTIONAL:
#   - REQUIRED: Security keys, database paths, Flask settings
#   - OPTIONAL: Google Drive integration, SMTP email, Cloud Functions
#
# GOOGLE DRIVE INTEGRATION:
#   Google Drive sync is OPTIONAL. If you don't need cloud backup:
#   - Set GOOGLE_DRIVE_AUTO_SYNC=false
#   - Set CLOUD_SYNC_ENABLED=false
#   - Leave GOOGLE_DRIVE_CREDENTIALS_PATH and GOOGLE_DRIVE_FOLDER_ID as-is
# ============================================================================

# ============================================================================
# DOCKER COMPOSE SETTINGS
# ============================================================================
# Deployment Mode
# Options: production, development
COMPOSE_PROJECT_NAME=vtrack
DEPLOYMENT_MODE=production

# Docker Images (Production)
# These images should be pre-built before running docker-compose
BACKEND_IMAGE=vtrack-backend:phase2
FRONTEND_IMAGE=vtrack-frontend:phase3

# Platform Architecture
# Options: linux/arm64 (Mac M1/M2/M3), linux/amd64 (Intel/AMD)
DOCKER_PLATFORM=linux/arm64

# ============================================================================
# DOCKER-SPECIFIC SETTINGS
# ============================================================================
# Flag to indicate running inside Docker container
VTRACK_IN_DOCKER=true

# Resource Directories (Docker/Container Paths)
# These paths are used inside the Docker container
# Volumes will be mapped from host to these container paths in docker-compose.yml
VTRACK_INPUT_DIR=/app/resources/input
VTRACK_OUTPUT_DIR=/app/resources/output
VTRACK_RESOURCES_DIR=/app/resources
VTRACK_SESSION_DIR=/app/var/flask_session

# Host Data Directory (Where data is stored on your machine)
# macOS/Linux: ~/docker/volumes/vtrack
# Windows: C:/VTrack
VTRACK_DATA_DIR=~/docker/volumes/vtrack

# Local Video Input Directory (Where you put videos to process)
LOCAL_VIDEO_PATH=./resources/Inputvideo

# Local Video Output Directory (Where processed videos are saved)
# This will be configured during Step 5 setup
# Example: /Users/username/Videos/Output (macOS)
# Example: C:/Videos/Output (Windows)
OUTPUT_PATH=

# Container networking - use service names from docker-compose.yml
FLASK_HOST=0.0.0.0
FLASK_PORT=8080

# Frontend configuration
NEXT_PUBLIC_PORT=3000
NODE_ENV=production

# API URL for frontend (browser-accessible URL)
# For Docker Compose internal networking: http://backend:8080 (container-to-container)
# For browser access from host machine: http://localhost:8080 (host-to-container)
# For remote server browser access: http://YOUR_SERVER_IP:8080
NEXT_PUBLIC_API_URL=http://localhost:8080

# Base path for Next.js (leave empty/commented out for root path)
# IMPORTANT: Next.js 15 crashes with empty string - comment out if not using
# NEXT_PUBLIC_BASE_PATH=

# ============================================================================
# SECURITY & ENCRYPTION (REQUIRED)
# ============================================================================
# Generate a secure SECRET_KEY:
#   python -c "import secrets; print(secrets.token_hex(32))"
SECRET_KEY=<REPLACE_WITH_YOUR_SECRET_KEY>

# Generate a secure ENCRYPTION_KEY:
#   python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
ENCRYPTION_KEY=<REPLACE_WITH_YOUR_ENCRYPTION_KEY>

# ============================================================================
# FLASK SETTINGS (REQUIRED)
# ============================================================================
FLASK_ENV=production
FLASK_DEBUG=false

# ============================================================================
# APPLICATION METADATA
# ============================================================================
APP_NAME=V_Track
APP_VERSION=2.1.0
APP_AUTHOR=V_Track Team

# ============================================================================
# DATABASE CONFIGURATION (REQUIRED)
# ============================================================================
# Database paths (Docker volumes will persist these)
DB_PATH=database/events.db
DB_BACKUP_PATH=database/backups
DB_AUTO_BACKUP=true
DB_BACKUP_INTERVAL=86400

# License database
LICENSE_DB_PATH=database/licenses.db
LICENSE_BACKUP_ENABLED=true

# License validation settings
LICENSE_VALIDATION_OFFLINE=true
LICENSE_CACHE_DURATION=86400

# ============================================================================
# CLOUD FUNCTIONS INTEGRATION (OPTIONAL)
# ============================================================================
# Payment and license service endpoints
# Update these URLs if you're using custom Google Cloud Functions
CLOUD_PAYMENT_URL=https://asia-southeast1-v-track-payments.cloudfunctions.net/create-payment
CLOUD_WEBHOOK_URL=https://asia-southeast1-v-track-payments.cloudfunctions.net/webhook-handler
CLOUD_LICENSE_URL=https://asia-southeast1-v-track-payments.cloudfunctions.net/license_service

# Health check endpoints
CLOUD_PAYMENT_HEALTH=https://asia-southeast1-v-track-payments.cloudfunctions.net/create-payment?action=health
CLOUD_WEBHOOK_HEALTH=https://asia-southeast1-v-track-payments.cloudfunctions.net/webhook-handler?action=health

# ============================================================================
# EMAIL CONFIGURATION (OPTIONAL - Required for license delivery)
# ============================================================================
# SMTP settings for sending license emails
# For Gmail: Use App Password (not regular password)
#   1. Enable 2-factor authentication on Gmail
#   2. Generate App Password: https://myaccount.google.com/apppasswords
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=<REPLACE_WITH_YOUR_EMAIL>
SMTP_PASSWORD=<REPLACE_WITH_YOUR_APP_PASSWORD>
SENDER_NAME=V_track License System
ADMIN_EMAIL=<REPLACE_WITH_ADMIN_EMAIL>

# Email template configuration
EMAIL_TEMPLATE_PATH=templates/emails
EMAIL_LOGO_URL=https://vtrack.app/assets/logo.png

# ============================================================================
# GOOGLE DRIVE INTEGRATION (OPTIONAL)
# ============================================================================
# Google Drive is OPTIONAL - only needed for cloud backup/sync
# If you don't need it: Set GOOGLE_DRIVE_AUTO_SYNC=false and CLOUD_SYNC_ENABLED=false

# Path to Google Drive credentials JSON file
# Download from: https://console.cloud.google.com/apis/credentials
GOOGLE_DRIVE_CREDENTIALS_PATH=credentials/google_drive_key.json

# Google Drive folder ID (where videos will be synced)
# Get from shared folder URL: https://drive.google.com/drive/folders/YOUR_FOLDER_ID
GOOGLE_DRIVE_FOLDER_ID=your_folder_id_here

# Auto-sync settings
GOOGLE_DRIVE_AUTO_SYNC=false
GOOGLE_DRIVE_SYNC_INTERVAL=3600

# Cloud storage settings
CLOUD_SYNC_ENABLED=false
CLOUD_MAX_FILE_SIZE_MB=100
CLOUD_RETRY_ATTEMPTS=3

# ============================================================================
# VIDEO PROCESSING CONFIGURATION
# ============================================================================
# OpenCV settings for Docker/Linux
# Use V4L2 for Linux Docker containers (not DirectShow which is Windows-only)
CV_CAMERA_BACKEND=V4L2
CV_BUFFER_SIZE=1
CV_FPS_LIMIT=30

# Video output settings
VIDEO_OUTPUT_PATH=recordings
VIDEO_CODEC=mp4v
VIDEO_QUALITY=720p
VIDEO_MAX_SIZE_MB=500

# Recording settings
AUTO_RECORDING=false
RECORDING_DURATION=300
RECORDING_QUALITY=high

# ============================================================================
# COMPUTER VISION SETTINGS
# ============================================================================
# Hand detection configuration
HAND_DETECTION_CONFIDENCE=0.5
HAND_TRACKING_CONFIDENCE=0.5
HAND_MAX_HANDS=2

# QR Code detection
QR_DETECTION_ENABLED=true
QR_MIN_SIZE=50
QR_MAX_SIZE=500

# Motion detection
MOTION_THRESHOLD=25
MOTION_MIN_AREA=500
MOTION_DILATE_ITERATIONS=2

# ============================================================================
# CAMERA MANAGEMENT
# ============================================================================
MAX_CAMERAS=16
CAMERA_TIMEOUT=30
CAMERA_RECONNECT_INTERVAL=60

# Stream processing
STREAM_BUFFER_SIZE=10
STREAM_QUALITY=medium
STREAM_COMPRESSION=h264

# ============================================================================
# UI/UX CONFIGURATION
# ============================================================================
# Window settings (for desktop app mode)
WINDOW_WIDTH=1200
WINDOW_HEIGHT=800
WINDOW_RESIZABLE=true
WINDOW_FULLSCREEN=false

# Theme settings
UI_THEME=modern
UI_ACCENT_COLOR=#2196F3
UI_FONT_SIZE=12
UI_ANIMATION_SPEED=300

# Language and date/time format
APP_LANGUAGE=en
DATE_FORMAT=%d/%m/%Y
TIME_FORMAT=%H:%M:%S

# ============================================================================
# LOGGING & MONITORING
# ============================================================================
LOG_LEVEL=INFO
LOG_FILE_PATH=logs/vtrack.log
LOG_MAX_SIZE_MB=10
LOG_BACKUP_COUNT=5
LOG_ROTATION=daily

# Performance monitoring
PERFORMANCE_MONITORING=true
MEMORY_USAGE_LIMIT_MB=512
CPU_USAGE_LIMIT_PERCENT=80

# Error reporting
ERROR_REPORTING=true
ERROR_LOG_PATH=logs/errors.log
CRASH_DUMP_PATH=logs/crash_dumps

# ============================================================================
# NETWORK & API SETTINGS
# ============================================================================
HTTP_TIMEOUT=30
HTTP_RETRY_ATTEMPTS=3
HTTP_USER_AGENT=V_Track_Docker_2.1.0

# API rate limiting
API_RATE_LIMIT=100
API_RATE_WINDOW=3600

# Network diagnostics
NETWORK_CHECK_ENABLED=true
NETWORK_CHECK_INTERVAL=300
NETWORK_CHECK_HOST=8.8.8.8

# ============================================================================
# FEATURE FLAGS
# ============================================================================
# Core detection features
FEATURE_HAND_DETECTION=true
FEATURE_QR_DETECTION=true
FEATURE_MOTION_DETECTION=true
FEATURE_FACE_DETECTION=false

# Advanced features
FEATURE_AI_ANALYTICS=false
FEATURE_CLOUD_PROCESSING=false
FEATURE_REAL_TIME_ALERTS=true

# Payment and licensing features
FEATURE_LICENSE_MANAGEMENT=true
FEATURE_SUBSCRIPTION_PLANS=true
FEATURE_TRIAL_MODE=true

# ============================================================================
# PRICING & PACKAGES
# ============================================================================
# Personal packages (prices in cents/smallest currency unit)
PERSONAL_1M_PRICE=2000
PERSONAL_1M_FEATURES=unlimited_cameras,basic_analytics,email_support
PERSONAL_1Y_PRICE=20000
PERSONAL_1Y_FEATURES=unlimited_cameras,basic_analytics,email_support,priority_support

# Business packages
BUSINESS_1M_PRICE=5000
BUSINESS_1M_FEATURES=unlimited_cameras,advanced_analytics,priority_support,api_access
BUSINESS_1Y_PRICE=50000
BUSINESS_1Y_FEATURES=unlimited_cameras,advanced_analytics,priority_support,api_access,custom_integration

# Trial settings
TRIAL_DURATION_DAYS=7
TRIAL_FEATURES=limited_cameras,basic_analytics
TRIAL_CAMERA_LIMIT=2

# ============================================================================
# DEVELOPMENT & DEBUG SETTINGS
# ============================================================================
# Debug flags (set to false in production)
DEBUG_MODE=false
DEBUG_CV_WINDOWS=false
DEBUG_NETWORK_LOGS=false
DEBUG_PERFORMANCE_LOGS=false

# Development tools
DEV_TOOLS_ENABLED=false
DEV_CONSOLE_ENABLED=false
DEV_HOT_RELOAD=false

# Testing
TEST_MODE=false
TEST_SKIP_LICENSE_CHECK=false
TEST_MOCK_CAMERAS=false

# ============================================================================
# BACKUP & RECOVERY
# ============================================================================
AUTO_BACKUP_ENABLED=true
BACKUP_INTERVAL_HOURS=24
BACKUP_RETENTION_DAYS=30
BACKUP_LOCATION=backups

# Recovery settings
RECOVERY_MODE=false
RECOVERY_BACKUP_PATH=backups/latest

# ============================================================================
# ADVANCED SETTINGS
# ============================================================================
# Memory management
MEMORY_CLEANUP_INTERVAL=300
MEMORY_CACHE_SIZE_MB=128
MEMORY_GC_THRESHOLD=0.8

# Threading
THREAD_POOL_SIZE=4
ASYNC_ENABLED=true
ASYNC_TIMEOUT=60

# Security
SECURITY_CHECK_ENABLED=true
SECURITY_HASH_ALGORITHM=SHA256
SECURITY_KEY_ROTATION=false

# ============================================================================
# PLATFORM DETECTION
# ============================================================================
PLATFORM_AUTO_DETECT=true
PLATFORM_WINDOWS_SUPPORT=true
PLATFORM_MAC_SUPPORT=true
PLATFORM_LINUX_SUPPORT=true

# ============================================================================
# ENVIRONMENT METADATA
# ============================================================================
ENV_NAME=docker
ENV_VERSION=2.1.0
ENV_UPDATED=2025-11-12
ENV_CLOUD_INTEGRATION=true

# ============================================================================
# QUICK START GUIDE
# ============================================================================
# 1. CONFIGURE ENVIRONMENT (AUTOMATED):
#    ./setup_prod.sh
#    
#    This script will:
#    - Create .env from template
#    - Generate secure SECRET_KEY and ENCRYPTION_KEY
#    - Set correct file permissions
#
#    (Alternative) Manual Setup:
#    cp .env.docker.example .env
#    # Then manually generate keys as described in the file
#
# 3. CONFIGURE EMAIL (OPTIONAL - for license delivery):
#    - Set SMTP_USERNAME to your Gmail address
#    - Set SMTP_PASSWORD to your Gmail App Password
#    - Set ADMIN_EMAIL to receive notifications
#
# 4. CONFIGURE GOOGLE DRIVE (OPTIONAL - for cloud backup):
#    - Download credentials JSON from Google Cloud Console
#    - Place in ./credentials/google_drive_key.json
#    - Set GOOGLE_DRIVE_FOLDER_ID from your Drive folder URL
#    - Set GOOGLE_DRIVE_AUTO_SYNC=true
#    - Set CLOUD_SYNC_ENABLED=true
#
# 5. START THE STACK:
#    docker-compose up -d
#
# 6. ACCESS THE APPLICATION:
#    - Frontend: http://localhost:3000
#    - Backend API: http://localhost:8080
#    - Health check: http://localhost:8080/api/health
#
# 7. MONITOR LOGS:
#    docker-compose logs -f
#
# ============================================================================
# TROUBLESHOOTING
# ============================================================================
# Camera not working in Docker:
#   - Ensure CV_CAMERA_BACKEND=V4L2 (not DirectShow)
#   - Add device mapping in docker-compose.yml: /dev/video0:/dev/video0
#   - Run container with --privileged flag for camera access
#
# Permission issues with volumes:
#   - Check file ownership: ls -la database/ logs/ recordings/
#   - Fix permissions: sudo chown -R $USER:$USER database/ logs/ recordings/
#
# Google Drive sync not working:
#   - Verify credentials file exists at GOOGLE_DRIVE_CREDENTIALS_PATH
#   - Check folder ID is correct
#   - Ensure service account has access to the folder
#
# Email not sending:
#   - For Gmail: Use App Password, not regular password
#   - Verify SMTP_PORT is 587 (TLS) or 465 (SSL)
#   - Check firewall allows outbound SMTP connections
#
# Frontend can't connect to backend:
#   - Verify NEXT_PUBLIC_API_URL matches your setup
#   - For remote access: use server IP instead of localhost
#   - Check both services are running: docker-compose ps
#
# ============================================================================
# SECURITY BEST PRACTICES
# ============================================================================
# 1. NEVER commit .env file to version control
# 2. Use strong, randomly generated keys for SECRET_KEY and ENCRYPTION_KEY
# 3. Rotate security keys periodically (every 90 days recommended)
# 4. Limit access to .env file: chmod 600 .env
# 5. Use separate .env files for dev/staging/production
# 6. Store sensitive credentials in Docker secrets for production
# 7. Enable firewall rules to restrict access to ports 3000 and 8080
# 8. Regularly update Docker images: docker-compose pull
# 9. Monitor logs for suspicious activity
# 10. Backup database and credentials regularly
# ============================================================================
